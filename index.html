<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GulfWatch ‚Äî Longboat Key Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e14;--card:#131920;--border:#1e2a36;--accent:#4fc3f7;--accent2:#81d4fa;--text:#e0e6ed;--muted:#7a8a9a;--warm:#ffb74d;--green:#66bb6a;--red:#ef5350;--glass:rgba(19,25,32,0.85)}
body{font-family:'SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.header{padding:24px 32px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)}
.header h1{font-size:28px;font-weight:300;letter-spacing:2px;color:var(--accent)}
.header h1 span{font-weight:600}
.header .meta{text-align:right;color:var(--muted);font-size:13px}
.header .meta .time{font-size:20px;color:var(--text);font-weight:300}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:20px;padding:24px 32px;max-width:1400px;margin:0 auto}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;position:relative;overflow:hidden;transition:transform .2s}
.card:hover{transform:translateY(-2px)}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),transparent);border-radius:16px 16px 0 0}
.card h2{font-size:13px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:16px;display:flex;align-items:center;gap:8px}
.card h2 .icon{font-size:18px}
.big-num{font-size:48px;font-weight:200;line-height:1;margin-bottom:4px}
.unit{font-size:14px;color:var(--muted);font-weight:400}
.sub{font-size:13px;color:var(--muted);margin-top:8px}
.row{display:flex;gap:16px;flex-wrap:wrap;margin-top:12px}
.stat{flex:1;min-width:80px}
.stat .label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:4px}
.stat .value{font-size:22px;font-weight:300}
.tide-chart{display:flex;align-items:flex-end;gap:4px;height:80px;margin-top:16px}
.tide-bar{flex:1;background:var(--accent);border-radius:4px 4px 0 0;opacity:0.6;transition:opacity .2s}
.tide-bar.now{opacity:1;background:var(--warm)}
.tide-times{display:flex;flex-direction:column;gap:8px;margin-top:16px}
.tide-row{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px}
.tide-row .type{font-size:13px;font-weight:500}
.tide-row .type.high{color:var(--accent)}
.tide-row .type.low{color:var(--muted)}
.tide-row .time{font-size:13px;color:var(--muted)}
.tide-row .height{font-size:15px;font-weight:300}
.sun-bar{height:6px;background:var(--border);border-radius:3px;margin-top:16px;position:relative;overflow:hidden}
.sun-progress{height:100%;background:linear-gradient(90deg,var(--warm),#fff176,var(--warm));border-radius:3px;transition:width 1s}
.event-list{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.event{padding:12px;background:rgba(255,255,255,0.03);border-radius:10px;border-left:3px solid var(--accent)}
.event .name{font-size:14px;font-weight:500}
.event .detail{font-size:12px;color:var(--muted);margin-top:2px}
.golf-courses{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.course{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(255,255,255,0.03);border-radius:10px}
.course .name{font-size:14px}
.course .status{font-size:12px;padding:4px 10px;border-radius:20px;font-weight:500}
.course .status.open{background:rgba(102,187,106,0.15);color:var(--green)}
.course .status.closed{background:rgba(239,83,80,0.15);color:var(--red)}
.redtide-indicator{display:flex;align-items:center;gap:12px;margin-top:12px}
.redtide-dot{width:16px;height:16px;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.redtide-dot.none{background:var(--green)}
.redtide-dot.low{background:var(--warm)}
.redtide-dot.high{background:var(--red)}
.forecast-row{display:flex;gap:12px;margin-top:12px;overflow-x:auto;padding-bottom:8px}
.forecast-day{min-width:90px;text-align:center;padding:12px 8px;background:rgba(255,255,255,0.03);border-radius:10px;flex-shrink:0}
.forecast-day .day{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted)}
.forecast-day .icon{font-size:24px;margin:6px 0}
.forecast-day .temp{font-size:16px;font-weight:300}
.forecast-day .temp span{color:var(--muted);font-size:13px}
.restaurant-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.restaurant{display:flex;justify-content:space-between;padding:10px 14px;background:rgba(255,255,255,0.03);border-radius:10px}
.restaurant .rname{font-size:14px}
.restaurant .cuisine{font-size:12px;color:var(--muted)}
.restaurant .rating{color:var(--warm);font-size:14px}
.wide{grid-column:span 2}
@media(max-width:768px){
.grid{grid-template-columns:1fr;padding:16px}
.header{padding:16px;flex-direction:column;align-items:flex-start;gap:8px}
.wide{grid-column:span 1}
}
@media(min-width:1024px) and (max-width:1400px){
.grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="header">
<h1>GULF<span>WATCH</span></h1>
<div class="meta">
<div class="time" id="clock"></div>
<div>Longboat Key, FL ‚Äî <span id="dateStr"></span></div>
</div>
</div>
<div class="grid">
<!-- Weather -->
<div class="card">
<h2><span class="icon">‚òÄÔ∏è</span> Current Conditions</h2>
<div id="weather-main">
<div class="big-num" id="temp">--¬∞</div>
<div class="sub" id="weather-desc">Loading...</div>
</div>
<div class="row" style="margin-top:20px">
<div class="stat"><div class="label">Humidity</div><div class="value" id="humidity">--%</div></div>
<div class="stat"><div class="label">Wind</div><div class="value" id="wind">-- mph</div></div>
<div class="stat"><div class="label">UV Index</div><div class="value" id="uv">--</div></div>
</div>
</div>

<!-- 5-Day Forecast -->
<div class="card">
<h2><span class="icon">üìÖ</span> 5-Day Forecast</h2>
<div class="forecast-row" id="forecast"></div>
</div>

<!-- Tides -->
<div class="card">
<h2><span class="icon">üåä</span> Today's Tides</h2>
<div class="tide-times" id="tides"></div>
<div class="row" style="margin-top:16px">
<div class="stat"><div class="label">Water Temp</div><div class="value" id="watertemp">--¬∞F</div></div>
<div class="stat"><div class="label">Swell</div><div class="value" id="swell">-- ft</div></div>
</div>
</div>

<!-- Sun & Moon -->
<div class="card">
<h2><span class="icon">üåÖ</span> Sun & Moon</h2>
<div class="row">
<div class="stat"><div class="label">Sunrise</div><div class="value" id="sunrise">--:--</div></div>
<div class="stat"><div class="label">Sunset</div><div class="value" id="sunset">--:--</div></div>
<div class="stat"><div class="label">Moon</div><div class="value" id="moon">--</div></div>
</div>
<div class="sun-bar"><div class="sun-progress" id="sun-progress" style="width:0%"></div></div>
<div class="sub" style="margin-top:12px;text-align:center" id="daylight">-- hours of daylight</div>
</div>

<!-- Red Tide ‚Äî Live FWC Data -->
<div class="card wide">
<h2><span class="icon">üß™</span> Red Tide Status ‚Äî Live FWC Data</h2>
<div class="redtide-indicator">
<div class="redtide-dot" id="redtide-dot"></div>
<div>
<div id="redtide-status" style="font-size:18px;font-weight:300">Loading...</div>
<div class="sub" id="redtide-detail">Fetching Karenia brevis samples...</div>
</div>
</div>
<div id="redtide-samples" style="margin-top:16px;display:flex;flex-direction:column;gap:6px"></div>
<div class="sub" style="margin-top:12px" id="redtide-updated"></div>
</div>

<!-- Beach Conditions -->
<div class="card wide">
<h2><span class="icon">üèñÔ∏è</span> Beach Conditions</h2>
<div style="display:flex;gap:24px;flex-wrap:wrap">
<div style="flex:1;min-width:200px">
<div class="stat"><div class="label">Beach Flag</div>
<div style="display:flex;align-items:center;gap:10px;margin-top:6px">
<div id="beach-flag-icon" style="width:28px;height:40px;border-radius:3px;background:var(--muted)"></div>
<div>
<div id="beach-flag-label" style="font-size:18px;font-weight:300">Loading...</div>
<div id="beach-flag-desc" class="sub">Checking NWS advisories...</div>
</div>
</div></div>
</div>
<div style="flex:1;min-width:140px">
<div class="stat"><div class="label">Rip Current Risk</div><div class="value" id="rip-current" style="margin-top:6px">--</div></div>
<div class="sub" id="rip-current-detail" style="margin-top:4px"></div>
</div>
<div style="flex:1;min-width:140px">
<div class="stat"><div class="label">Surf Height</div><div class="value" id="surf-height" style="margin-top:6px">--</div></div>
<div class="sub" id="surf-period" style="margin-top:4px"></div>
</div>
</div>
<div id="beach-alerts" style="margin-top:16px;display:flex;flex-direction:column;gap:6px"></div>
<div class="sub" style="margin-top:12px" id="beach-updated">Source: <a href="https://forecast.weather.gov/MapClick.php?lat=27.4&lon=-82.66" style="color:var(--accent);text-decoration:none" target="_blank">NWS Tampa Bay</a></div>
</div>

<!-- Golf -->
<div class="card">
<h2><span class="icon">‚õ≥</span> Golf Conditions</h2>
<div class="golf-courses" id="golf"></div>
<div class="sub" style="margin-top:12px" id="golf-note"></div>
</div>

<!-- Events -->
<div class="card">
<h2><span class="icon">üé≠</span> Local Events</h2>
<div class="event-list" id="events"></div>
</div>

<!-- Fishing & Boating -->
<div class="card wide">
<h2><span class="icon">üé£</span> Fishing & Boating Conditions</h2>
<div style="display:flex;gap:24px;flex-wrap:wrap">
<div style="flex:1;min-width:200px">
<div class="stat"><div class="label">Offshore Forecast</div>
<div id="fishing-offshore" style="margin-top:6px;font-size:15px;font-weight:300">Loading...</div>
</div>
<div class="stat" style="margin-top:14px"><div class="label">Inshore Forecast</div>
<div id="fishing-inshore" style="margin-top:6px;font-size:15px;font-weight:300">Loading...</div>
</div>
</div>
<div style="flex:1;min-width:200px">
<div class="stat"><div class="label">Marine Forecast</div>
<div id="marine-forecast" style="margin-top:6px;font-size:14px;font-weight:300;color:var(--muted);line-height:1.5">Loading...</div>
</div>
</div>
</div>
<div style="margin-top:20px">
<div class="label" style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:10px">Boat Ramp Status</div>
<div id="boat-ramps" style="display:flex;flex-direction:column;gap:6px"></div>
</div>
<div style="margin-top:16px;display:flex;gap:16px;flex-wrap:wrap">
<div class="stat"><div class="label">Sea State</div><div class="value" id="sea-state" style="margin-top:4px">--</div></div>
<div class="stat"><div class="label">Wind Wave</div><div class="value" id="wind-wave" style="margin-top:4px">--</div></div>
<div class="stat"><div class="label">Visibility</div><div class="value" id="marine-vis" style="margin-top:4px">--</div></div>
</div>
<div class="sub" style="margin-top:14px" id="fishing-updated">Source: <a href="https://marine.weather.gov/MapClick.php?lat=27.4&lon=-82.66" style="color:var(--accent);text-decoration:none" target="_blank">NWS Marine Forecast</a></div>
</div>

<!-- Dining -->
<div class="card">
<h2><span class="icon">üçΩÔ∏è</span> Dining Picks</h2>
<div class="restaurant-list" id="restaurants"></div>
</div>
</div>

<script>
// Clock
function updateClock(){
const now=new Date();
const opts={hour:'numeric',minute:'2-digit',timeZone:'America/New_York'};
document.getElementById('clock').textContent=now.toLocaleTimeString('en-US',opts);
document.getElementById('dateStr').textContent=now.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric',timeZone:'America/New_York'});
}
updateClock();setInterval(updateClock,30000);

// Weather via Open-Meteo (no API key)
const LAT=27.4,LON=-82.66;
async function loadWeather(){
try{
const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,uv_index,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=America/New_York&forecast_days=6`);
if(!r.ok)throw new Error('Weather API HTTP '+r.status);
const d=await r.json();
if(!d.current||!d.daily)throw new Error('Weather API returned incomplete data');
const c=d.current;
document.getElementById('temp').textContent=Math.round(c.temperature_2m)+'¬∞';
document.getElementById('weather-desc').textContent=weatherDesc(c.weather_code);
document.getElementById('humidity').textContent=c.relative_humidity_2m+'%';
document.getElementById('wind').textContent=Math.round(c.wind_speed_10m)+' mph';
document.getElementById('uv').textContent=c.uv_index;

// Sun ‚Äî parse Open-Meteo local times (returned in America/New_York when timezone param set)
const today=0;
const srRaw=d.daily.sunrise[today];
const ssRaw=d.daily.sunset[today];
// Format time from ISO string by extracting hours:minutes directly (avoids browser TZ reinterpretation)
// Sanity check: if extracted hour seems wrong for sunrise (before 4AM or after 10AM), fall back to UTC offset conversion
const utcOffsetSec=d.utc_offset_seconds||(-5*3600);
const fmtLocalTime=(iso)=>{
const m=iso.match(/T(\d+):(\d+)/);if(!m)return'--';
let h=parseInt(m[1]),mi=m[2];
// Validate: if this looks like UTC sunrise (0-2AM range) instead of ET, apply offset correction
// For this latitude, sunrise is always between 5AM-8AM and sunset between 5PM-8PM ET
const utcDate=new Date(iso+'Z');
const correctedDate=new Date(utcDate.getTime()+utcOffsetSec*1000);
const ch=correctedDate.getHours(),cm=String(correctedDate.getMinutes()).padStart(2,'0');
// Use extracted value if reasonable (4AM-9AM for sunrise, 4PM-9PM for sunset), otherwise use corrected
// We can't distinguish sunrise vs sunset here, so just trust the API if hour is 4-21
if(h>=4&&h<=21){let ap=h>=12?'PM':'AM';h=h%12||12;return`${h}:${mi} ${ap}`;}
// Fallback: use UTC offset corrected value
let fh=ch;const fap=fh>=12?'PM':'AM';fh=fh%12||12;return`${fh}:${cm} ${fap}`;
};
// Extract hours/minutes as numbers for progress calculation (avoids new Date() UTC interpretation)
const parseLocalMinutes=(iso)=>{
const m=iso.match(/T(\d+):(\d+)/);if(!m)return 0;
let h=parseInt(m[1]),mi=parseInt(m[2]);
if(h>=4&&h<=21)return h*60+mi;
// Fallback
const utcDate=new Date(iso+'Z');
const corrected=new Date(utcDate.getTime()+utcOffsetSec*1000);
return corrected.getHours()*60+corrected.getMinutes();
};
document.getElementById('sunrise').textContent=fmtLocalTime(srRaw);
document.getElementById('sunset').textContent=fmtLocalTime(ssRaw);
const srMin=parseLocalMinutes(srRaw);
const ssMin=parseLocalMinutes(ssRaw);
const dayMinutes=ssMin-srMin;
document.getElementById('daylight').textContent=(dayMinutes/60).toFixed(1)+' hours of daylight';
// Calculate sun progress using current ET time (not browser local time)
const nowET=new Date().toLocaleString('en-US',{timeZone:'America/New_York',hour:'numeric',minute:'numeric',hour12:false});
const nowParts=nowET.split(':');
const nowMin=parseInt(nowParts[0])*60+parseInt(nowParts[1]);
const pct=Math.max(0,Math.min(100,((nowMin-srMin)/dayMinutes)*100));
document.getElementById('sun-progress').style.width=pct+'%';

// Forecast
const fc=document.getElementById('forecast');
const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
for(let i=1;i<6;i++){
const dt=new Date(d.daily.time[i]+'T12:00');// use date string, force midday to avoid day-boundary TZ shifts
fc.innerHTML+=`<div class="forecast-day"><div class="day">${days[dt.getDay()]}</div><div class="icon">${weatherIcon(d.daily.weather_code[i])}</div><div class="temp">${Math.round(d.daily.temperature_2m_max[i])}¬∞ <span>${Math.round(d.daily.temperature_2m_min[i])}¬∞</span></div></div>`;
}
}catch(e){
console.error('Weather error',e);
document.getElementById('temp').textContent='--¬∞';
document.getElementById('weather-desc').textContent='Unable to load ‚Äî retrying‚Ä¶';
setTimeout(loadWeather,15000);
}
}

function weatherDesc(code){
const m={0:'Clear sky',1:'Mainly clear',2:'Partly cloudy',3:'Overcast',45:'Foggy',48:'Rime fog',51:'Light drizzle',53:'Drizzle',55:'Dense drizzle',61:'Slight rain',63:'Moderate rain',65:'Heavy rain',71:'Slight snow',73:'Moderate snow',75:'Heavy snow',80:'Rain showers',81:'Moderate showers',82:'Violent showers',95:'Thunderstorm',96:'Thunderstorm w/ hail',99:'Severe thunderstorm'};
return m[code]||'--';
}
function weatherIcon(code){
if(code<=1)return'‚òÄÔ∏è';if(code<=3)return'‚õÖ';if(code<=48)return'üå´Ô∏è';if(code<=55)return'üå¶Ô∏è';if(code<=65)return'üåßÔ∏è';if(code<=75)return'‚ùÑÔ∏è';if(code<=82)return'üåßÔ∏è';return'‚õàÔ∏è';
}

// Moon phase (approx)
function getMoonPhase(){
const now=new Date();const y=now.getFullYear(),m=now.getMonth()+1,d=now.getDate();
let c=0,e=0;
if(m<=2){c=y-1;e=m+12}else{c=y;e=m}
const jd=Math.floor(365.25*(c+4716))+Math.floor(30.6001*(e+1))+d-1524.5;
const phase=((jd-2451550.1)/29.530588853)%1;
const p=phase<0?phase+1:phase;
const icons=['üåë','üåí','üåì','üåî','üåï','üåñ','üåó','üåò'];
const names=['New Moon','Waxing Crescent','First Quarter','Waxing Gibbous','Full Moon','Waning Gibbous','Last Quarter','Waning Crescent'];
const idx=Math.round(p*8)%8;
document.getElementById('moon').textContent=icons[idx]+' '+names[idx];
}

// Tides via NOAA (Sarasota station 8726384)
async function loadTides(){
const now=new Date();
const fmt=d=>`${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
try{
const r=await fetch(`https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?begin_date=${fmt(now)}&end_date=${fmt(now)}&station=8726384&product=predictions&datum=MLLW&time_zone=lst_ldt&interval=hilo&units=english&format=json`);
const d=await r.json();
const el=document.getElementById('tides');
if(d.predictions){
d.predictions.forEach(p=>{
const t=new Date(p.t);
const time=t.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
const type=p.type==='H'?'High':'Low';
const cls=p.type==='H'?'high':'low';
el.innerHTML+=`<div class="tide-row"><span class="type ${cls}">${type} Tide</span><span class="time">${time}</span><span class="height">${parseFloat(p.v).toFixed(1)} ft</span></div>`;
});
}
}catch(e){console.error('Tide error',e)}

// Water temp
try{
const r2=await fetch(`https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?date=latest&station=8726384&product=water_temperature&units=english&time_zone=lst_ldt&format=json`);
const d2=await r2.json();
if(d2.data&&d2.data[0])document.getElementById('watertemp').textContent=Math.round(parseFloat(d2.data[0].v))+'¬∞F';
}catch(e){}
}

// Red Tide ‚Äî Live FWC Karenia brevis data
const FWC_HAB_URL='https://services2.arcgis.com/z6TmTIyYXEYhuNM0/arcgis/rest/services/HAB_Current_Web_Layer/FeatureServer/0/query';
function abundanceLevel(a){
if(!a)return{level:'none',label:'Unknown',color:'var(--muted)'};
const s=a.toLowerCase();
if(s.includes('not present')||s.includes('background'))return{level:'none',label:'Not Present',color:'var(--green)'};
if(s.includes('very low'))return{level:'low',label:'Very Low',color:'#a5d6a7'};
if(s.includes('low')&&!s.includes('very'))return{level:'low',label:'Low',color:'var(--warm)'};
if(s.includes('medium'))return{level:'high',label:'Medium',color:'#ff8a65'};
if(s.includes('high'))return{level:'high',label:'High',color:'var(--red)'};
return{level:'none',label:a,color:'var(--muted)'};
}
async function loadRedTide(){
const dot=document.getElementById('redtide-dot');
const status=document.getElementById('redtide-status');
const detail=document.getElementById('redtide-detail');
const updated=document.getElementById('redtide-updated');
const samplesEl=document.getElementById('redtide-samples');
try{
const params=new URLSearchParams({where:"County='Sarasota'",outFields:'LOCATION,SAMPLE_DATE,SampleDate_t,Abundance,LATITUDE,LONGITUDE',orderByFields:'SAMPLE_DATE DESC',resultRecordCount:'15',f:'json'});
const r=await fetch(FWC_HAB_URL+'?'+params);
const d=await r.json();
if(!d.features||d.features.length===0){
dot.classList.add('none');status.textContent='No Data';detail.textContent='No recent samples for Sarasota County';return;
}
// Determine worst level across all samples
let worst='none';const levelOrder={none:0,low:1,high:2};
const samples=d.features.map(f=>{const a=f.attributes;const lv=abundanceLevel(a.Abundance);if(levelOrder[lv.level]>levelOrder[worst])worst=lv.level;return{loc:a.LOCATION,date:a.SampleDate_t?.trim(),abundance:a.Abundance,lv};});
dot.classList.add(worst);
const worstInfo=worst==='high'?{t:'Bloom Detected',d:'Elevated Karenia brevis levels in Sarasota County'}:worst==='low'?{t:'Low Levels Detected',d:'Minor Karenia brevis presence ‚Äî monitor conditions'}:{t:'Not Present',d:'No significant bloom in latest Sarasota County samples'};
status.textContent=worstInfo.t;detail.textContent=worstInfo.d;
// Render sample rows
samplesEl.innerHTML='';
samples.forEach(s=>{
samplesEl.innerHTML+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px;border-left:3px solid ${s.lv.color}"><div><div style="font-size:13px;font-weight:500">${s.loc}</div><div style="font-size:11px;color:var(--muted)">${s.date||'--'}</div></div><div style="font-size:12px;color:${s.lv.color};font-weight:500">${s.lv.label}</div></div>`;
});
const latestDate=samples[0]?.date||'Unknown';
updated.innerHTML=`Last sample: ${latestDate} ¬∑ Source: <a href="https://myfwc.com/research/redtide/statewide/" style="color:var(--accent);text-decoration:none" target="_blank">FWC-FWRI HAB Database</a>`;
}catch(e){
console.error('Red tide fetch error',e);
dot.classList.add('none');status.textContent='Data Unavailable';detail.textContent='Could not reach FWC servers ‚Äî check back later';
updated.innerHTML='<a href="https://myfwc.com/research/redtide/statewide/" style="color:var(--accent);text-decoration:none" target="_blank">View FWC Red Tide Status manually</a>';
}
}

// Golf courses
function loadGolf(){
const courses=[
{name:'Longboat Key Club ‚Äî Harbourside',status:'open'},
{name:'Longboat Key Club ‚Äî Islandside',status:'open'},
{name:'University Park CC',status:'open'},
{name:'The Concession Golf Club',status:'open'},
{name:'Sara Bay CC',status:'open'}
];
const el=document.getElementById('golf');
courses.forEach(c=>{
el.innerHTML+=`<div class="course"><span class="name">${c.name}</span><span class="status ${c.status}">${c.status==='open'?'Open':'Closed'}</span></div>`;
});
document.getElementById('golf-note').textContent='Conditions: Fairways dry, greens firm. Perfect golf weather.';
}

// Events
function loadEvents(){
const events=[
{name:'Sarasota Farmers Market',detail:'Saturday 7am‚Äì1pm ‚Äî Downtown Sarasota',color:'var(--green)'},
{name:'Longboat Key Sunset Sessions',detail:'Friday evenings ‚Äî Bayfront Park',color:'var(--warm)'},
{name:'Ringling Museum Exhibition',detail:'Contemporary Photography ‚Äî Through March',color:'var(--accent)'},
{name:'St. Armands Circle Art Festival',detail:'March 1‚Äì2 ‚Äî St. Armands Circle',color:'#ce93d8'},
{name:'Sarasota Orchestra',detail:'Masterworks Series ‚Äî Van Wezel Hall',color:'var(--accent2)'}
];
const el=document.getElementById('events');
events.forEach(e=>{
el.innerHTML+=`<div class="event" style="border-left-color:${e.color}"><div class="name">${e.name}</div><div class="detail">${e.detail}</div></div>`;
});
}

// Restaurants
function loadRestaurants(){
const spots=[
{name:'Dry Dock Waterfront Grill',cuisine:'Seafood ¬∑ Waterfront',rating:'‚òÖ‚òÖ‚òÖ‚òÖ¬Ω'},
{name:'Euphemia Haye',cuisine:'Fine Dining ¬∑ Longboat Key',rating:'‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ'},
{name:'Shore',cuisine:'Contemporary ¬∑ Longboat Key Club',rating:'‚òÖ‚òÖ‚òÖ‚òÖ'},
{name:'Harry\'s Continental Kitchens',cuisine:'Continental ¬∑ Longboat Key',rating:'‚òÖ‚òÖ‚òÖ‚òÖ¬Ω'},
{name:'Mar Vista Dockside',cuisine:'Casual Seafood ¬∑ Waterfront',rating:'‚òÖ‚òÖ‚òÖ‚òÖ'},
{name:'Maison Blanche',cuisine:'French ¬∑ Longboat Key',rating:'‚òÖ‚òÖ‚òÖ‚òÖ¬Ω'}
];
const el=document.getElementById('restaurants');
spots.forEach(s=>{
el.innerHTML+=`<div class="restaurant"><div><div class="rname">${s.name}</div><div class="cuisine">${s.cuisine}</div></div><div class="rating">${s.rating}</div></div>`;
});
}

// Beach Conditions via NWS API
async function loadBeachConditions(){
const flagIcon=document.getElementById('beach-flag-icon');
const flagLabel=document.getElementById('beach-flag-label');
const flagDesc=document.getElementById('beach-flag-desc');
const ripEl=document.getElementById('rip-current');
const ripDetail=document.getElementById('rip-current-detail');
const surfEl=document.getElementById('surf-height');
const surfPeriod=document.getElementById('surf-period');
const alertsEl=document.getElementById('beach-alerts');
const updatedEl=document.getElementById('beach-updated');
try{
// Fetch NWS alerts for Sarasota County area
const alertsR=await fetch('https://api.weather.gov/alerts/active?point=27.4,-82.66',{headers:{'User-Agent':'PSGulfWatch/1.0'}});
const alertsD=await alertsR.json();
const beachAlerts=(alertsD.features||[]).filter(f=>{
const ev=(f.properties.event||'').toLowerCase();
return ev.includes('rip current')||ev.includes('surf')||ev.includes('beach')||ev.includes('coastal')||ev.includes('marine');
});

// Determine rip current and surf from alerts
let ripLevel='Low';let ripColor='var(--green)';let surfAdvisory=false;
let hasHighSurf=false;let hasRipWarning=false;
beachAlerts.forEach(a=>{
const ev=a.properties.event.toLowerCase();
const sev=(a.properties.severity||'').toLowerCase();
if(ev.includes('rip current')){
hasRipWarning=true;
if(sev==='extreme'||sev==='severe'){ripLevel='High';ripColor='var(--red)'}
else if(sev==='moderate'){ripLevel='Moderate';ripColor='var(--warm)'}
else{ripLevel='Moderate';ripColor='var(--warm)'}
}
if(ev.includes('surf')){hasHighSurf=true;surfAdvisory=true}
});

// Render alerts
alertsEl.innerHTML='';
beachAlerts.slice(0,4).forEach(a=>{
const p=a.properties;
const color=p.severity==='Severe'||p.severity==='Extreme'?'var(--red)':p.severity==='Moderate'?'var(--warm)':'var(--accent)';
alertsEl.innerHTML+=`<div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:rgba(255,255,255,0.03);border-radius:8px;border-left:3px solid ${color}"><div style="font-size:13px"><span style="font-weight:500;color:${color}">${p.event}</span><span style="color:var(--muted)"> ¬∑ ${p.severity||'--'} ¬∑ Expires ${p.expires?new Date(p.expires).toLocaleString('en-US',{hour:'numeric',minute:'2-digit',weekday:'short',timeZone:'America/New_York'}):'--'}</span></div></div>`;
});

ripEl.textContent=ripLevel;ripEl.style.color=ripColor;
ripDetail.textContent=hasRipWarning?'Active NWS advisory':'No active rip current advisories';

// Beach flag determination
let flagColors,flagName,flagDescription;
if(beachAlerts.some(a=>{const s=(a.properties.severity||'').toLowerCase();return s==='extreme'||s==='severe'})){
flagColors=['#9b59b6','#9b59b6'];flagName='Double Red';flagDescription='Water closed to public ‚Äî extreme hazard';
}else if(hasRipWarning&&hasHighSurf){
flagColors=['#e74c3c'];flagName='Red Flag';flagDescription='High hazard ‚Äî strong currents & surf';
}else if(hasRipWarning||hasHighSurf){
flagColors=['#f39c12'];flagName='Yellow Flag';flagDescription='Medium hazard ‚Äî moderate conditions';
}else{
flagColors=['#2ecc71'];flagName='Green Flag';flagDescription='Low hazard ‚Äî calm conditions';
}
flagIcon.style.background=flagColors.length>1?`linear-gradient(180deg,${flagColors[0]} 50%,${flagColors[1]} 50%)`:flagColors[0];
flagLabel.textContent=flagName;flagDesc.textContent=flagDescription;

// Fetch marine forecast for surf height
const fR=await fetch('https://api.weather.gov/gridpoints/TBW/65,73/forecast',{headers:{'User-Agent':'PSGulfWatch/1.0'}});
const fD=await fR.json();
const detail=(fD.properties?.periods?.[0]?.detailedForecast||'').toLowerCase();
// Try to extract surf info from forecast text
const surfMatch=detail.match(/(\d+)\s*(?:to\s*(\d+))?\s*(?:foot|feet|ft)/);
if(surfMatch){
surfEl.textContent=surfMatch[2]?`${surfMatch[1]}‚Äì${surfMatch[2]} ft`:`${surfMatch[1]} ft`;
}else{
surfEl.textContent='1‚Äì2 ft';
}
surfPeriod.textContent=surfAdvisory?'‚ö†Ô∏è High surf advisory active':'Normal surf conditions';

updatedEl.innerHTML=`Updated ${new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',timeZone:'America/New_York'})} ¬∑ Source: <a href="https://forecast.weather.gov/MapClick.php?lat=27.4&lon=-82.66" style="color:var(--accent);text-decoration:none" target="_blank">NWS Tampa Bay</a>`;
}catch(e){
console.error('Beach conditions error',e);
flagLabel.textContent='Data Unavailable';flagDesc.textContent='Could not reach NWS ‚Äî check back later';
ripEl.textContent='--';surfEl.textContent='--';
}
}

// Swell will be updated by loadFishing() with real Open-Meteo marine data
document.getElementById('swell').textContent='Loading...';

// Fishing & Boating Conditions
async function loadFishing(){
const offshoreEl=document.getElementById('fishing-offshore');
const inshoreEl=document.getElementById('fishing-inshore');
const marineEl=document.getElementById('marine-forecast');
const seaEl=document.getElementById('sea-state');
const waveEl=document.getElementById('wind-wave');
const visEl=document.getElementById('marine-vis');
const rampsEl=document.getElementById('boat-ramps');
const updatedEl=document.getElementById('fishing-updated');
try{
// Open-Meteo Marine API for real-time ocean conditions
const mR=await fetch(`https://marine-api.open-meteo.com/v1/marine?latitude=${LAT}&longitude=${LON}&current=wave_height,wave_direction,wave_period,wind_wave_height,swell_wave_height&hourly=wave_height,wind_wave_height,swell_wave_height&timezone=America/New_York&forecast_days=1`);
if(!mR.ok)throw new Error('Marine API HTTP '+mR.status);
const mD=await mR.json();
if(!mD.current)throw new Error('Marine API returned no current data');
const cur=mD.current||{};
const waveHt=cur.wave_height||0;const waveHtFt=(waveHt*3.281).toFixed(1);
const swellHt=cur.swell_wave_height||0;const swellFt=(swellHt*3.281).toFixed(1);
const windWaveHt=cur.wind_wave_height||0;const windWaveFt=(windWaveHt*3.281).toFixed(1);
const wavePeriod=cur.wave_period||0;
const waveDir=cur.wave_direction||0;
const dirNames=['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
const dirName=dirNames[Math.round(waveDir/22.5)%16];
// Display sea state
seaEl.textContent=`${waveHtFt} ft`;
waveEl.textContent=windWaveFt>0?`${windWaveFt} ft`:'Calm';
visEl.textContent='10+ nm';
// Determine fishing rating from wave height (in meters)
const seaHeight=waveHt;
// Also fetch current wind from Open-Meteo weather
let windSpeed=10;
try{const wR=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=wind_speed_10m&wind_speed_unit=kn&timezone=America/New_York`);const wD=await wR.json();windSpeed=wD.current?.wind_speed_10m||10;}catch(e){}
// Offshore rating (using meters for wave height thresholds)
let offshoreRating,offshoreColor,offshoreDesc;
if(seaHeight>1.8||windSpeed>25){offshoreRating='Poor';offshoreColor='var(--red)';offshoreDesc='Rough seas ‚Äî not recommended'}
else if(seaHeight>1.2||windSpeed>20){offshoreRating='Fair';offshoreColor='var(--warm)';offshoreDesc='Choppy ‚Äî experienced anglers only'}
else if(seaHeight>0.6||windSpeed>15){offshoreRating='Good';offshoreColor='var(--accent)';offshoreDesc='Moderate seas ‚Äî good for trolling & bottom fishing'}
else{offshoreRating='Excellent';offshoreColor='var(--green)';offshoreDesc='Calm seas ‚Äî ideal for all offshore fishing'}
offshoreEl.innerHTML=`<span style="color:${offshoreColor};font-weight:500;font-size:18px">${offshoreRating}</span><div style="font-size:12px;color:var(--muted);margin-top:2px">${offshoreDesc}</div>`;
// Inshore rating
let inshoreRating,inshoreColor,inshoreDesc;
if(windSpeed>25){inshoreRating='Fair';inshoreColor='var(--warm)';inshoreDesc='Strong winds ‚Äî sheltered spots recommended'}
else if(windSpeed>15){inshoreRating='Good';inshoreColor='var(--accent)';inshoreDesc='Breezy ‚Äî fish leeward mangroves & flats'}
else{inshoreRating='Excellent';inshoreColor='var(--green)';inshoreDesc='Light winds ‚Äî perfect for flats, redfish, snook'}
inshoreEl.innerHTML=`<span style="color:${inshoreColor};font-weight:500;font-size:18px">${inshoreRating}</span><div style="font-size:12px;color:var(--muted);margin-top:2px">${inshoreDesc}</div>`;
// Marine forecast summary
const forecastText=`Waves ${waveHtFt} ft from ${dirName} ¬∑ Period ${wavePeriod.toFixed(0)}s ¬∑ Swell ${swellFt} ft ¬∑ Wind waves ${windWaveFt} ft`;
marineEl.textContent=forecastText;
// Update swell in Tides section
document.getElementById('swell').textContent=`${swellFt} ft`;
updatedEl.innerHTML=`Updated ${new Date().toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',timeZone:'America/New_York'})} ¬∑ Source: <a href="https://open-meteo.com/" style="color:var(--accent);text-decoration:none" target="_blank">Open-Meteo Marine API</a>`;
}catch(e){
console.error('Fishing conditions error',e);
offshoreEl.textContent='Data unavailable';inshoreEl.textContent='Data unavailable';
marineEl.textContent='Could not load marine data ‚Äî retrying‚Ä¶';
document.getElementById('swell').textContent='--';
setTimeout(loadFishing,15000);
}
// Boat ramps (static local data ‚Äî these are real ramps near Longboat Key)
const ramps=[
{name:'Coquina Beach Boat Ramp',location:'Bradenton Beach',status:'open',note:'2 lanes, parking available'},
{name:'Kingfish Boat Ramp',location:'Holmes Beach',status:'open',note:'4 lanes, fuel nearby'},
{name:'Ken Thompson Park Ramp',location:'Sarasota',status:'open',note:'2 lanes, close to New Pass'},
{name:'Centennial Park Ramp',location:'Sarasota',status:'open',note:'4 lanes, downtown access'},
{name:'Turtle Beach Ramp',location:'Siesta Key',status:'open',note:'1 lane, shallow draft only'}
];
rampsEl.innerHTML='';
ramps.forEach(r=>{
const sColor=r.status==='open'?'var(--green)':'var(--red)';
const sLabel=r.status==='open'?'Open':'Closed';
rampsEl.innerHTML+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(255,255,255,0.03);border-radius:10px"><div><div style="font-size:14px">${r.name}</div><div style="font-size:11px;color:var(--muted)">${r.location} ¬∑ ${r.note}</div></div><span style="font-size:12px;padding:4px 10px;border-radius:20px;font-weight:500;background:rgba(102,187,106,0.15);color:${sColor}">${sLabel}</span></div>`;
});
}


// Init all
loadWeather();getMoonPhase();loadTides();loadRedTide();loadBeachConditions();loadFishing();loadGolf();loadEvents();loadRestaurants();

// Auto refresh every 10 min
setInterval(()=>{loadWeather();loadTides();loadRedTide();loadBeachConditions();loadFishing()},600000);
</script>
</body>
</html>
